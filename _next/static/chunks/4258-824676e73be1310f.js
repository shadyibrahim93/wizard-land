"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4258],{4258:(e,l,t)=>{t.r(l),t.d(l,{default:()=>S});var r=t(5155),n=t(2115),a=t(973),u=t(9252),i=t(5744),o=t(5361),s=t(104),m=t(6646),f=t(5385),p=t(7055),c=t(9206),y=t(6710),d=t(8410),w=t(5695),h=t(6562);let S=()=>{let[e,l]=(0,n.useState)(Array(6).fill(null).map(()=>Array(7).fill(null))),[t,S]=(0,n.useState)(!1),[v,g]=(0,n.useState)(null),[M,x]=(0,n.useState)(!1),[E,j]=(0,n.useState)(0),[k,A]=(0,n.useState)(0),[b,q]=(0,n.useState)(!1),[I,N]=(0,n.useState)("Fire"),[T,L]=(0,n.useState)("Single"),[$,F]=(0,n.useState)(null),[C,_]=(0,n.useState)(null),[D,W]=(0,n.useState)(!1),[O,G]=(0,n.useState)(4),[R,H]=(0,n.useState)(null),[J,K]=(0,n.useState)(null),[Q,X]=(0,n.useState)(null),[z,B]=(0,n.useState)(!1),[P,U]=(0,n.useState)(0),[V,Y]=(0,n.useState)([]),{userId:Z,userName:ee}=(0,p.J)(),el=(0,f.v)(R||Z,"\uD83D\uDD25","fire"),et=(0,f.v)(J,"❄️","ice"),[er,en]=(0,n.useState)(""),[ea,eu]=(0,n.useState)(!1),[ei,eo]=(0,n.useState)(!1),[es,em]=(0,n.useState)(null),[ef,ep]=(0,n.useState)(null),ec=(0,w.useRouter)(),[ey,ed]=(0,n.useState)(!1),[ew,eh]=(0,n.useState)(0),[eS,ev]=(0,n.useState)(""),[eg,eM]=(0,n.useState)("");(0,n.useEffect)(()=>{(async()=>{(v||eE(e))&&(S(!0),"Multiplayer"===T&&(v===Z?(eu(!0),await (0,s.Hy)(v,O)):v!==Z&&await (0,s.oH)(Z,O)),v===Z||"Fire"===v?((0,u.Yj)(),(0,o.Lk)()):v!==Z&&(0,u.SI)(),"Multiplayer"===T?R===v?j(E+1):J===v&&U(P+1):(v===Z&&j(E+1),"Ice"===v&&(A(k+1),W(!0))),(0,u.XQ)(),q(!0),setTimeout(()=>{"Multiplayer"===T?eo(!0):eq(),q(!1),en("")},3500))})()},[v]),(0,n.useEffect)(()=>{if(!Q?.room)return;let e=(0,s.PI)(Q.room,e=>{let{user_id:l,choice:t}=e;l===Z?null==es&&em(t):null==ef&&ep(t)});return()=>s.ND.realtime.removeChannel(e)},[Q,Z,ew]),(0,n.useEffect)(()=>{if(null==es||null==ef)return;let e="up"===es&&"up"===ef,l=Q.room;(0,s.DL)(l).then(()=>{em(null),ep(null),eo(!1),eh(e=>e+1),e?eq():eN()}).catch(console.error)},[es,ef]);let ex=e=>{let l=(l,t,r,n)=>{let a=0,u=e[l][t];for(let i=0;i<4;i++){let o=l+r*i,s=t+n*i;if(o>=0&&o<6&&s>=0&&s<7&&e[o][s]===u)a++;else break}return 4===a?u:null};for(let t=0;t<6;t++)for(let r=0;r<7;r++)if(e[t][r]){let n=l(t,r,0,1)||l(t,r,1,0)||l(t,r,1,1)||l(t,r,1,-1);if(n)if("Multiplayer"===T)return n===R?R:J;else return n===Z?"Fire":"Ice";if(eE(e))return null}return null},eE=e=>!!e&&!!Array.isArray(e)&&0!==e.length&&e.every(e=>Array.isArray(e)&&e.every(e=>null!==e)),ej=r=>{if(t||null!==e[0][r])return;let n=e.map(e=>[...e]),a=null;for(let e=5;e>=0;e--)if(!n[e][r]){a=e;break}if(null!==a){if("Single"===T){if("Fire"!==I)return;n[a][r]=Z,l(n);let e=ex(n);if(e)return void g(e);if(eE(n.flat())){g(null),S(!0),(0,u.XQ)(),q(!0),setTimeout(()=>{(0,u.SW)(),eq()},3500);return}N("Ice"),eA(n)}else if("Multiplayer"===T){if(!z||!Z||C!==Z)return void alert("Not your turn!");n[a][r]=Z===R?R:J,l(n);let e=ex(n),t=Z===R?J:R;if(_(t),e){g(e),(0,s.lu)(Q.room,n,O,null,e);return}if(eE(n)){(0,s.lu)(Q.room,n,O,null,null),g(null),S(!0),q(!0),setTimeout(()=>{eq()},2e3);return}(0,s.lu)(Q.room,n,O,t)}}},ek=(0,n.useRef)(!0);(0,n.useEffect)(()=>{if(ek.current){ek.current=!1;return}if(v||eE(e))return;let l="";"Multiplayer"===T&&R?l=C===J?el.key:et.key:"Single"===T&&"Ice"===I&&(l=el.key),(0,u.oS)(l)},[C,I]);let eA=e=>{let t=e.map(e=>[...e]),r=e=>{for(let l=0;l<7;l++)for(let r=5;r>=0;r--)if(!t[r][l]){t[r][l]=e;let n=ex(t)===("❄️"===e?"Ice":"Fire");if(t[r][l]=null,n)return l;break}return null};setTimeout(()=>{(0,u.oS)();let e=r("❄️");if(null!==e){for(let r=5;r>=0;r--)if(!t[r][e]){t[r][e]="❄️",l(t);let n=ex(t);n&&g(n),N("Fire");return}}let n=r(Z);if(null!==n){for(let e=5;e>=0;e--)if(!t[e][n]){t[e][n]="❄️",l(t),N("Fire");return}}let a=[];for(let e=0;e<7;e++)for(let l=5;l>=0;l--)if(!t[l][e]){a.push(e);break}if(a.length>0){let e=a[Math.floor(Math.random()*a.length)];for(let r=5;r>=0;r--)if(!t[r][e]){t[r][e]="❄️",l(t),N("Fire");return}}},2e3)},eb=l=>{for(let t=5;t>=0;t--)if(!e[t][l])return t;return -1},eq=()=>{let e=Array(6).fill(null).map(()=>Array(7).fill(null));if(l(e),S(!1),g(null),q(!1),"Single"===T)"Ice"===v?(N("Ice"),setTimeout(()=>{eA(e)},500)):N("Fire");else if("Multiplayer"===T){let l=v===J?J:R;_(l),(0,s.lu)(Q.room,e,O,l)}(0,u.SW)()},eI=async t=>{t&&t.room?(X(t),H(t.player1),K(t.player2),ev(t.player1name||""),eM(t.player2name||""),L("Multiplayer"),x(!0),_(t.player1),B(!!t.player1&&!!t.player2),Y([(0,s.Z5)(t.room,l=>{H(l.player1),K(l.player2),ev(l.player1name||""),eM(l.player2name||""),B(!!l.player1&&!!l.player2),(0,u.NL)("battle"),l.player1&&l.player2&&e.every(e=>null===e)&&(0,s.lu)(t.room,Array(6).fill(null).map(()=>Array(7).fill(null)),O,l.player1)}),(0,s.qk)(t.room,e=>{e.board_state&&(l(e.board_state),S(!1),g(null),q(!1),em(null),ep(null),(0,s.DL)(e.room)),void 0!==e.current_turn&&null!==e.current_turn&&_(e.current_turn),e.winner&&(en(e.name),g(e.winner),(0,c.v)(e.winner,"easy"),(0,s.JI)(e.room,e.game_id))})])):(L("Single"),x(!0))},eN=()=>{ed(!1),"Multiplayer"===T&&((0,s.i4)(Q.room,O),(0,s.Kt)(Q.room)),ec.push("/")};(0,n.useEffect)(()=>()=>{"Multiplayer"===T&&(0,s.Kt)(V)},[V]),(0,n.useEffect)(()=>{let e;if("Multiplayer"!==T)return;let l=()=>{clearTimeout(e),e=window.setTimeout(()=>{ed(!0)},3e4)},t=["mousemove","keydown","mousedown","touchstart"];return t.forEach(e=>window.addEventListener(e,l)),l(),()=>{clearTimeout(e),t.forEach(e=>window.removeEventListener(e,l))}},[J]),(0,n.useEffect)(()=>{if("Multiplayer"!==T)return;window.history.pushState(null,"",window.location.href);let e=e=>{e.preventDefault(),window.history.pushState(null,"",window.location.href),ed(!0)};return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[T]),(0,n.useEffect)(()=>{if("Multiplayer"!==T)return;let e=e=>{ed(!0),e.preventDefault(),e.returnValue=""};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[T]),(0,n.useEffect)(()=>{if(!Q?.room||"Multiplayer"!==T)return;let e=Date.now(),l=setInterval(()=>{Date.now()-e>6e4&&(alert("Ops, Opponent left the game! What a bummer!"),eN())},1e4);return()=>clearInterval(l)},[e]);let eT=null===v&&eE(e)?"It's a Draw!":v?"Multiplayer"===T?`${er} wins!`:`${v} wins!`:"Opponent Turn";return M?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mq-global-container",children:[(0,r.jsxs)("div",{className:"mq-score-container",children:[(0,r.jsx)("span",{className:"mq-score-player",children:(0,r.jsxs)("span",{className:"mq-score-player",children:[eS||ee,": ",E]})}),(0,r.jsxs)("span",{className:"mq-room-number",children:[Q&&Q.room," ",Q&&Q.password&&`- ${Q.password}`]}),(0,r.jsx)("span",{className:"mq-score-computer",children:"Multiplayer"===T?eg?`${eg}: ${P}`:"Waiting opponent...":`Ice: ${k}`})]}),(0,r.jsxs)("div",{className:`mq-board mq-${"Multiplayer"===T?C===R?el.theme:et.theme:"Fire"===I?el.theme:"ice"}`,children:[b&&(0,r.jsx)("h1",{className:`mq-ending-title ${("Ice"===v||v===J)&&"glowingBlue-text"}`,children:eT}),e.map((e,l)=>e.map((e,t)=>(0,r.jsxs)("div",{className:`mq-square mq-${e?"Single"===T?e===Z?"fire":"ice":e===R?"fire":e===J?"ice":"":""}  ${$===t&&l===eb(t)?"mq-preview":""} ${e===Z&&!el.display||e===J&&!et.display?"mq-image":""}`,onClick:()=>ej(t),onMouseEnter:()=>F(t),onMouseLeave:()=>F(null),children:[e&&("Single"===T?e===Z?el.display||el.image:et.display||et.image:e===R?el.display||el.image:e===J?et.display||et.image:e),(0,r.jsx)("span",{children:"Single"===T||"Multiplayer"===T&&C===R?el.display||el.image:et.display||et.image})]},`${l}-${t}`)))]})]}),(0,r.jsx)(i.A,{text:"Reset Score",onClick:()=>{A(0),j(0)}}),ea&&(0,r.jsx)(y.T,{onComplete:()=>eu(!1)}),(0,r.jsx)(d.A,{isOpen:ei,onClose:()=>{eo(!1)},onThumbsUp:()=>{em("up"),(0,s.r7)(Q.room,Z,"up")},onThumbsDown:()=>{em("down"),(0,s.r7)(Q.room,Z,"down")}}),(0,r.jsx)(h.A,{isOpen:ey,onConfirm:eN,onCancel:()=>ed(!1),title:"Leave Game? Auto-quit in "})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.A,{introText:"Welcome to Wizard Land Connect 4! Take turns dropping your element into the corresponding column. A helper will show you where the element will land when you hover over a column. Align four in a row, column, or diagonal to win. Good luck!"}),(0,r.jsx)(m.A,{gameId:O,setGameMode:L,onStartGame:(e,l)=>eI(e,l)})]})}}}]);