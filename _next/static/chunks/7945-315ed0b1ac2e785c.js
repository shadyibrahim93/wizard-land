"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7945],{7945:(e,l,t)=>{t.r(l),t.d(l,{default:()=>S});var r=t(5155),n=t(2115),a=t(973),u=t(9252),i=t(5744),o=t(5361),s=t(104),m=t(6646),p=t(5385),c=t(7055),f=t(9206),d=t(6710),y=t(8410),w=t(5695),h=t(6562);let S=()=>{let[e,l]=(0,n.useState)(Array(9).fill(null)),[t,S]=(0,n.useState)(!1),[g,v]=(0,n.useState)(null),[M,x]=(0,n.useState)(!1),[E,j]=(0,n.useState)(0),[T,b]=(0,n.useState)(0),[k,q]=(0,n.useState)(!1),[I,N]=(0,n.useState)("Fire"),[F,L]=(0,n.useState)(null),[_,$]=(0,n.useState)("Single"),[A,C]=(0,n.useState)(null),[D,O]=(0,n.useState)(9),[G,W]=(0,n.useState)(null),[R,H]=(0,n.useState)(null),[J,K]=(0,n.useState)(null),[B,P]=(0,n.useState)(!1),[Q,U]=(0,n.useState)(0),[V,X]=(0,n.useState)([]),{userId:Y,userName:Z}=(0,c.J)(),z=(0,p.v)(G||Y,"\uD83D\uDD25","fire"),ee=(0,p.v)(R,"❄️","ice"),[el,et]=(0,n.useState)(""),[er,en]=(0,n.useState)(!1),[ea,eu]=(0,n.useState)(!1),[ei,eo]=(0,n.useState)(null),[es,em]=(0,n.useState)(null),ep=(0,w.useRouter)(),[ec,ef]=(0,n.useState)(!1),[ed,ey]=(0,n.useState)(0),[ew,eh]=(0,n.useState)(""),[eS,eg]=(0,n.useState)("");(0,n.useEffect)(()=>{(async()=>{(g||ex(e))&&(S(!0),e.every(e=>null===e)&&v(null),"Multiplayer"===_&&(g===Y?(en(!0),await (0,s.Hy)(g,D)):g!==Y&&await (0,s.oH)(Y,D)),g===Y||"Fire"===g?((0,u.Yj)(),(0,o.Lk)()):g!==Y&&(0,u.SI)(),"Multiplayer"===_?G===g?j(E+1):R===g&&U(Q+1):("Fire"===g&&j(E+1),"Ice"===g&&b(T+1)),(0,u.XQ)(),q(!0),setTimeout(()=>{"Multiplayer"===_?eu(!0):eb(),q(!1),et("")},3500))})()},[g]),(0,n.useEffect)(()=>{if(!J?.room)return;let e=(0,s.PI)(J.room,e=>{let{user_id:l,choice:t}=e;l===Y?null==ei&&eo(t):null==es&&em(t)});return()=>s.ND.realtime.removeChannel(e)},[J,Y,ed]),(0,n.useEffect)(()=>{if(null==ei||null==es)return;let e="up"===ei&&"up"===es,l=J.room;(0,s.DL)(l).then(()=>{eo(null),em(null),eu(!1),ey(e=>e+1),e?eb():eq()}).catch(console.error)},[ei,es]);let ev=(e,l)=>{let t=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(let r=0;r<t.length;r++){let[n,a,u]=t[r];if(e[n]===l&&e[a]===l&&null===e[u])return u;if(e[n]===l&&e[u]===l&&null===e[a])return a;if(e[a]===l&&e[u]===l&&null===e[n])return n}return null},eM=e=>{let l=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(let t=0;t<l.length;t++){let[r,n,a]=l[t];if(e[r]&&e[r]===e[n]&&e[r]===e[a]){if("Multiplayer"===_)return e[r]===G?G:R;return e[r]===Y?"Fire":"Ice"}}return null},ex=e=>e.every(e=>null!==e),eE=async r=>{if(!e[r]&&!t){if("Single"===_){if("Fire"!==I)return;let t=[...e];t[r]=Y,l(t);let n=eM(t);if(n)return void v(n);if(ex(t)){v(null),S(!0),q(!0),setTimeout(()=>{eb()},2e3);return}N("Ice"),eT(t)}else if("Multiplayer"===_){if(!B||!Y)return;if(F!==Y)return void alert("Not your turn!");let t=[...e];t[r]=Y===G?G:R,l(t);let n=eM(t),a=Y===G?R:G;if(L(a),n){v(n),(0,s.lu)(J.room,t,D,null,n);return}if(ex(t)){(0,s.lu)(J.room,t,D,null,n),v(null),S(!0),setTimeout(()=>{eb()},2e3);return}(0,s.lu)(J.room,t,D,a)}}},ej=(0,n.useRef)(!0);(0,n.useEffect)(()=>{if(ej.current){ej.current=!1;return}if(g||ex(e))return;let l="";"Multiplayer"===_&&G?l=F===R?z.key:ee.key:"Single"===_&&"Ice"===I&&(l=z.key),(0,u.oS)(l)},[F,I]);let eT=e=>{let t=[...e];setTimeout(()=>{(0,u.oS)();let e=ev(t,"❄️");if(null!==e){t[e]="❄️",l(t);let r=eM(t);r?v(r):N("Fire");return}let r=ev(t,Y);if(null!==r){t[r]="❄️",l(t);let e=eM(t);e?v(e):N("Fire");return}let n=t.map((e,l)=>null===e?l:null).filter(e=>null!==e);if(n.length>0){t[n[Math.floor(Math.random()*n.length)]]="❄️",l(t);let e=eM(t);e?v(e):N("Fire")}},2e3)},eb=()=>{let e=Array(9).fill(null);if(l(e),S(!1),v(null),q(!1),"Single"===_)"Ice"===g?(N("Ice"),setTimeout(()=>{eT(e)},500)):N("Fire");else if("Multiplayer"===_){let l=g===R?R:G;L(l),(0,s.lu)(J.room,e,D,l)}(0,u.SW)()},ek=async t=>{t&&t.room?(K(t),W(t.player1),H(t.player2),eh(t.player1name||""),eg(t.player2name||""),$("Multiplayer"),x(!0),L(t.player1),P(!!t.player1&&!!t.player2),X([(0,s.Z5)(t.room,l=>{W(l.player1),H(l.player2),eh(l.player1name||""),eg(l.player2name||""),P(!!l.player1&&!!l.player2),(0,u.NL)("battle"),l.player1&&l.player2&&e.every(e=>null===e)&&(0,s.lu)(t.room,Array(9).fill(null),D,l.player1)}),(0,s.qk)(t.room,e=>{e.board_state&&(l(e.board_state),S(!1),v(null),q(!1),eu(!1),et(""),eo(null),em(null),(0,s.DL)(e.room)),void 0!==e.current_turn&&null!==e.current_turn&&L(e.current_turn),e.winner&&(et(e.name),v(e.winner),(0,f.v)(e.winner,"easy"),(0,s.JI)(e.room,e.game_id)),e.board_state&&ex(e.board_state)&&!e.winner&&(q(!0),setTimeout(()=>{q(!1)},2e3))})])):($("Single"),x(!0))},eq=()=>{ef(!1),"Multiplayer"===_&&((0,s.i4)(J.room,D),(0,s.Kt)(J.room)),ep.push("/")};(0,n.useEffect)(()=>()=>{"Multiplayer"===_&&(0,s.Kt)(V)},[V]),(0,n.useEffect)(()=>{let e;if("Multiplayer"!==_)return;let l=()=>{clearTimeout(e),e=window.setTimeout(()=>{ef(!0)},3e4)},t=["mousemove","keydown","mousedown","touchstart"];return t.forEach(e=>window.addEventListener(e,l)),l(),()=>{clearTimeout(e),t.forEach(e=>window.removeEventListener(e,l))}},[R]),(0,n.useEffect)(()=>{if("Multiplayer"!==_)return;window.history.pushState(null,"",window.location.href);let e=e=>{e.preventDefault(),window.history.pushState(null,"",window.location.href),ef(!0)};return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[_]),(0,n.useEffect)(()=>{if("Multiplayer"!==_)return;let e=e=>{ef(!0),e.preventDefault(),e.returnValue=""};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[_]),(0,n.useEffect)(()=>{if(!J?.room||"Multiplayer"!==_)return;let e=Date.now(),l=setInterval(()=>{Date.now()-e>6e4&&(alert("Ops, Opponent left the game! What a bummer!"),eq())},1e4);return()=>clearInterval(l)},[e]);let eI=null===g&&ex(e)?"It's a Draw!":g?"Multiplayer"===_?`${el} wins!`:`${g} wins!`:"Opponent Turn";return M?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mq-global-container",children:[(0,r.jsxs)("div",{className:"mq-score-container",children:[(0,r.jsx)("span",{className:"mq-score-player",children:(0,r.jsxs)("span",{className:"mq-score-player",children:[ew||Z,": ",E]})}),(0,r.jsxs)("span",{className:"mq-room-number",children:[J&&J.room," ",J&&J.password&&`- ${J.password}`]}),(0,r.jsx)("span",{className:"mq-score-computer",children:"Multiplayer"===_?eS?`${eS}: ${Q}`:"Waiting opponent...":`Ice: ${T}`})]}),(0,r.jsxs)("div",{className:`mq-board mq-${"Multiplayer"===_?F===G?z.theme:ee.theme:"Fire"===I?z.theme:"ice"}`,children:[k&&(0,r.jsx)("h1",{className:`mq-ending-title ${("Ice"===g||g===R)&&"glowingBlue-text"}`,children:eI}),e.map((e,l)=>(0,r.jsxs)("div",{className:`mq-square 
                      mq-${e?"Single"===_?e===Y?"fire":"ice":e===G?"fire":e===R?"ice":"":""}
                      ${!e&&A===l?"mq-preview":""} 
                      ${e===Y&&!z.display||e===R&&!ee.display?"mq-image":""}`,onClick:()=>eE(l),onMouseEnter:()=>C(l),onMouseLeave:()=>C(null),children:[e&&("Single"===_?e===Y?z.display||z.image:ee.display||ee.image:e===G?z.display||z.image:e===R?ee.display||ee.image:e),(0,r.jsx)("span",{children:"Single"===_||"Multiplayer"===_&&F===G?z.display||z.image:ee.display||ee.image})]},l))]})]}),(0,r.jsx)(i.A,{text:"Reset Score",onClick:()=>{b(0),j(0)}}),er&&(0,r.jsx)(d.T,{onComplete:()=>en(!1)}),(0,r.jsx)(y.A,{isOpen:ea,onClose:()=>{eu(!1)},onThumbsUp:()=>{eo("up"),(0,s.r7)(J.room,Y,"up")},onThumbsDown:()=>{eo("down"),(0,s.r7)(J.room,Y,"down")}}),(0,r.jsx)(h.A,{isOpen:ec,onConfirm:eq,onCancel:()=>ef(!1),title:"Leave Game? Auto-quit in "})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.A,{introText:"Welcome to Tic Tac Toe!. Take turns placing your marks, aiming to align three in a row, column, or diagonal. A helper will show you where your mark will go when you hover over a box. Good luck!"}),(0,r.jsx)(m.A,{gameId:D,setGameMode:$,onStartGame:(e,l)=>ek(e,l)})]})}}}]);