"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4162],{4162:(e,l,t)=>{t.r(l),t.d(l,{default:()=>w});var r=t(5155),n=t(2115),u=t(973),a=t(9252),i=t(5744),o=t(5361),s=t(104),m=t(6646),p=t(5385),c=t(7055),f=t(9206),d=t(6710),y=t(8410),h=t(5695),S=t(6562);let w=()=>{let[e,l]=(0,n.useState)(Array(16).fill(null)),[t,w]=(0,n.useState)(!1),[v,g]=(0,n.useState)(null),[x,M]=(0,n.useState)(!1),[b,E]=(0,n.useState)(0),[j,q]=(0,n.useState)(0),[I,$]=(0,n.useState)(!1),[k,N]=(0,n.useState)("Fire"),[F,T]=(0,n.useState)(null),[A,L]=(0,n.useState)("Single"),[C,D]=(0,n.useState)("place"),[_,O]=(0,n.useState)(5),[W]=(0,n.useState)(12),[G,P]=(0,n.useState)(null),[R,H]=(0,n.useState)(null),[J,K]=(0,n.useState)(null),[Q,X]=(0,n.useState)(!1),[B,U]=(0,n.useState)(0),[V,Y]=(0,n.useState)([]),{userId:Z,userName:z}=(0,c.J)(),ee=(0,p.v)(G||Z,"\uD83D\uDD25","fire"),el=(0,p.v)(R,"❄️","ice"),[et,er]=(0,n.useState)(""),[en,eu]=(0,n.useState)(!1),[ea,ei]=(0,n.useState)(!1),[eo,es]=(0,n.useState)(null),[em,ep]=(0,n.useState)(null),ec=(0,h.useRouter)(),[ef,ed]=(0,n.useState)(!1),[ey,eh]=(0,n.useState)(0),[eS,ew]=(0,n.useState)(""),[ev,eg]=(0,n.useState)(""),ex=[0,1,2,3,7,11,15,14,13,12,8,4],eM=[5,6,10,9],eb=`
    Welcome to Orbito! Align 4 of your marbles in a row.
    1) Place your marble on any free square.
    2) Press Shift to rotate all marbles once around the rings.
    First to 4 in a row wins!`,eE=e=>e.every(e=>null!==e),ej=e=>{let l=[];for(let t=0;t<4;t++)l.push(e.slice(4*t,(t+1)*4));let t=[];for(let e=0;e<4;e++)t.push(l[e]);for(let e=0;e<4;e++)t.push([l[0][e],l[1][e],l[2][e],l[3][e]]);for(let e of(t.push([l[0][0],l[1][1],l[2][2],l[3][3]]),t.push([l[0][3],l[1][2],l[2][1],l[3][0]]),t))if(e.every(l=>l&&l===e[0])){if("Multiplayer"===A)return e[0]===G?G:R;return e[0]===Z?"Fire":"Ice"}return null},eq=e=>{(0,a.$1)();let l=[...e],t=e=>{let t=l[e[0]];for(let t=0;t<e.length-1;t++)l[e[t]]=l[e[t+1]];l[e[e.length-1]]=t};return t(ex),t(eM),l};(0,n.useEffect)(()=>{(async()=>{e.every(e=>null===e)&&g(null),eE(e)&&0===_&&(w(!0),(0,a.XQ)(),$(!0),setTimeout(()=>{"Multiplayer"===A?ei(!0):eN(),$(!1),er("")},3500)),v&&(w(!0),"Multiplayer"===A&&(v===Z?(eu(!0),await (0,s.Hy)(v,W)):v!==Z&&await (0,s.oH)(Z,W)),v===Z||"Fire"===v?((0,a.Yj)(),(0,o.Lk)()):v!==Z&&(0,a.SI)(),"Multiplayer"===A?G===v?E(b+1):R===v&&U(B+1):("Fire"===v&&E(b+1),"Ice"===v&&q(j+1)),(0,a.XQ)(),$(!0),setTimeout(()=>{"Multiplayer"===A?ei(!0):eN(),$(!1),er("")},3500))})()},[v,e,_,t,J,A,Z,G,R]);let eI=r=>{if("Single"===A&&"Ice"===k||t||eE(e)||"place"!==C||null!==e[r])return;let n="Multiplayer"===A?F===G?G:R:"Fire"===k?Z:"Ice";if("Single"===A){let t=[...e];t[r]=n,l(t);let u=ej(t);if(u)return void g(u);D("orbit")}else if("Multiplayer"===A){if(!Q||!Z)return;if(F!==Z)return void alert("Not your turn!");let t=[...e];t[r]=Z===G?G:R,l(t),D("orbit");let n=ej(t);if((0,s.lu)(J.room,t,W,F),n){g(n),(0,s.lu)(J.room,t,W,null,n);return}}},e$=(0,n.useRef)(!0);(0,n.useEffect)(()=>{if(e$.current){e$.current=!1;return}if(v)return;let e="";"Multiplayer"===A&&G&&"place"===C?e=F===R?ee.key:el.key:"Single"===A&&"Ice"===k&&(e=ee.key),(0,a.oS)(e)},[F,k]);let ek=()=>{if(t||ej(e))return;let r=[...e];if(eE(e)&&_>0)return void setTimeout(()=>{let t=eq(e);l(t),O(e=>e-1);let r=ej(t);if(r)return void g(r);D("place"),N("Fire")},500);let n=r.map((e,l)=>null===e?l:null).filter(e=>null!=e);0!==n.length&&(r[n[Math.floor(Math.random()*n.length)]]=el.key,setTimeout(()=>{l(r),(0,a.oS)();let e=ej(r);if(e)return void g(e);setTimeout(()=>{let e=eq(r);l(e);let t=ej(e);if(t)return void g(t);D("place"),N("Fire")},500)},500))};(0,n.useEffect)(()=>{"Single"!==A||"place"!==C||"Ice"!==k||t||ek()},[A,C,k,t]),(0,n.useEffect)(()=>{if("Single"===A&&"orbit"===C&&"Ice"===k&&!t){let t=eq(e),r=ej(t);if(r){l(t),g(r);return}eE(t)&&_>0&&O(e=>e-1),l(t),D("place"),N("Fire")}},[C,k,e,A,t,_]);let eN=()=>{if(es(null),ep(null),l(Array(16).fill(null)),w(!1),g(null),$(!1),ei(!1),D("place"),"Multiplayer"===A){let e=v===R?R:G;T(e),(0,s.lu)(J.room,Array(16).fill(null),W,e)}else N("Fire");(0,a.SW)()},eF=async t=>{t&&t.room?(K(t),P(t.player1),H(t.player2),ew(t.player1name||""),eg(t.player2name||""),L("Multiplayer"),M(!0),T(t.player1),X(!!t.player1&&!!t.player2),Y([(0,s.Z5)(t.room,l=>{P(l.player1),H(l.player2),ew(l.player1name||""),eg(l.player2name||""),X(!!l.player1&&!!l.player2),(0,a.NL)("battle"),l.player1&&l.player2&&e.every(e=>null===e)&&(0,s.lu)(t.room,Array(16).fill(null),W,l.player1)}),(0,s.qk)(t.room,e=>{e.board_state&&(l(e.board_state),w(!1),g(null),$(!1),ei(!1),er(""),es(null),ep(null),(0,s.DL)(e.room)),void 0!==e.extraShifts&&O(e.extraShifts),void 0!==e.current_turn&&null!==e.current_turn&&T(e.current_turn),e.winner&&(er(e.name),g(e.winner),(0,f.v)(e.winner,"easy"),(0,s.JI)(e.room,e.game_id))})])):(L("Single"),M(!0))};(0,n.useEffect)(()=>{if(!J?.room)return;let e=(0,s.PI)(J.room,e=>{let{user_id:l,choice:t}=e;l===Z?null==eo&&es(t):null==em&&ep(t)});return()=>s.ND.realtime.removeChannel(e)},[J,Z,ey]),(0,n.useEffect)(()=>{if(null==eo||null==em)return;let e="up"===eo&&"up"===em,l=J.room;(0,s.DL)(l).then(()=>{es(null),ep(null),ei(!1),eh(e=>e+1),e?eN():eT()}).catch(console.error)},[eo,em]);let eT=()=>{ed(!1),"Multiplayer"===A&&((0,s.i4)(J.room,W),(0,s.Kt)(J.room)),ec.push("/")};(0,n.useEffect)(()=>()=>{"Multiplayer"===A&&(0,s.Kt)(V)},[V]),(0,n.useEffect)(()=>{let e;if("Multiplayer"!==A)return;let l=()=>{clearTimeout(e),e=window.setTimeout(()=>{ed(!0)},3e4)},t=["mousemove","keydown","mousedown","touchstart"];return t.forEach(e=>window.addEventListener(e,l)),l(),()=>{clearTimeout(e),t.forEach(e=>window.removeEventListener(e,l))}},[R]),(0,n.useEffect)(()=>{if("Multiplayer"!==A)return;window.history.pushState(null,"",window.location.href);let e=e=>{e.preventDefault(),window.history.pushState(null,"",window.location.href),ed(!0)};return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[A]),(0,n.useEffect)(()=>{if("Multiplayer"!==A)return;let e=e=>{ed(!0),e.preventDefault(),e.returnValue=""};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[A]),(0,n.useEffect)(()=>{if(!J?.room||"Multiplayer"!==A)return;let e=Date.now(),l=setInterval(()=>{Date.now()-e>6e4&&(alert("Ops, Opponent left the game! What a bummer!"),eT())},1e4);return()=>clearInterval(l)},[e]);let eA=null===v&&eE(e)&&0===_?"It's a Draw!":v?"Multiplayer"===A?`${et} wins!`:`${v} wins!`:"Opponent Turn";return x?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mq-global-container",children:[(0,r.jsxs)("div",{className:"mq-score-container",children:[(0,r.jsx)("span",{className:"mq-score-player",children:(0,r.jsxs)("span",{className:"mq-score-player",children:[eS||z,": ",b]})}),(0,r.jsxs)("span",{className:"mq-room-number",children:[J&&J.room," ",J&&J.password&&`- ${J.password}`]}),(0,r.jsx)("span",{className:"mq-score-computer",children:"Multiplayer"===A?ev?`${ev}: ${B}`:"Waiting opponent...":`Ice: ${j}`})]}),(0,r.jsxs)("div",{className:`mq-board mq-${"Multiplayer"===A?F===G?ee.theme:el.theme:"Fire"===k?ee.theme:"ice"}`,children:[I&&(0,r.jsx)("h1",{className:`mq-ending-title ${"Ice"===v||v===R?"glowingBlue-text":""}`,children:eA}),e.map((e,l)=>(0,r.jsx)("div",{className:`mq-square
                ${e?`mq-${e}`:""}
                ${eM.includes(l)?"mq-inner":"mq-outer"}
                ${e===Z&&!ee.display||e===R&&!el.display?"mq-image":""}
                mq-${e?"Single"===A?e===Z?"fire":"ice":e===G?"fire":e===R?"ice":"":""}`,onClick:()=>eI(l),children:e&&("Single"===A?e===Z?ee.display||ee.image:el.display||el.image:e===G?ee.display||ee.image:e===R?el.display||el.image:e)},l)),(0,r.jsx)(i.A,{text:eE(e)?`${_}`:"↺",onClick:()=>{let t=eq(e);if("Single"===A){l(t),eE(t)&&_>0&&O(e=>e-1);let e=ej(t);return e?void g(e):(D("place"),void N("Ice"))}if(eE(e)&&_>0){let e=_-1;if(O(e),(0,s.lu)(J.room,t,W,null,null,e),0===e){let l=ej(t);l&&((0,s.lu)(J.room,t,W,null,l,e),g(l));return}let l=ej(t);if(l){(0,s.lu)(J.room,t,W,null,l,e),g(l);return}let r=Z===G?R:G;(0,s.lu)(J.room,t,W,r,null,e),T(r),D("place")}else if("Multiplayer"===A){let e=ej(t),l=Z===G?R:G;if((0,s.lu)(J.room,t,W,l),T(l),D("place"),e){(0,s.lu)(J.room,t,W,null,e),g(e);return}}},isDisabled:!!(t||"Multiplayer"===A&&F!==Z||!eE(e)&&"orbit"!==C||eE(e)&&_<=0)})]})]}),(0,r.jsx)(i.A,{text:"Reset Score",onClick:()=>{q(0),E(0)}}),en&&(0,r.jsx)(d.T,{onComplete:()=>eu(!1)}),(0,r.jsx)(y.A,{isOpen:ea,onClose:()=>{ei(!1)},onThumbsUp:()=>{es("up"),(0,s.r7)(J.room,Z,"up")},onThumbsDown:()=>{es("down"),(0,s.r7)(J.room,Z,"down")}}),(0,r.jsx)(S.A,{isOpen:ef,onConfirm:eT,onCancel:()=>ed(!1),title:"Leave Game? Auto-quit in "})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.A,{introText:eb}),(0,r.jsx)(m.A,{gameId:W,setGameMode:L,onStartGame:eF})]})}}}]);