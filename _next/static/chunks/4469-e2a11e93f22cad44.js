"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4469],{4469:(e,t,r)=>{r.r(t),r.d(t,{default:()=>b});var l=r(5155),o=r(2115),a=r(973),n=r(9252),u=r(5744),i=r(5361),s=r(104),c=r(6646),p=r(5385),m=r(7055),h=r(9206),y=r(6710),f=r(8410),d=r(5695),w=r(6562);let v={white:{king:"♚",queen:"♛",rook:"♜",bishop:"♝",knight:"♞",pawn:"♙"},black:{king:"♚",queen:"♛",rook:"♜",bishop:"♝",knight:"♞",pawn:"♟"}},k=()=>{let e=Array(8).fill(null).map(()=>Array(8).fill(null)),t=e=>[{type:"rook",color:e,moved:!1},{type:"knight",color:e,moved:!1},{type:"bishop",color:e,moved:!1},{type:"queen",color:e,moved:!1},{type:"king",color:e,moved:!1},{type:"bishop",color:e,moved:!1},{type:"knight",color:e,moved:!1},{type:"rook",color:e,moved:!1}];return e[0]=t("black"),e[7]=t("white"),e[1]=Array(8).fill(null).map(()=>({type:"pawn",color:"black",moved:!1})),e[6]=Array(8).fill(null).map(()=>({type:"pawn",color:"white",moved:!1})),e},b=()=>{let[e,t]=(0,o.useState)(k()),[r,b]=(0,o.useState)(!1),[g,S]=(0,o.useState)(null),[A,M]=(0,o.useState)(!1),[E,q]=(0,o.useState)(0),[x,j]=(0,o.useState)(0),[$,N]=(0,o.useState)(!1),[_,T]=(0,o.useState)("white"),[C,L]=(0,o.useState)(null),[D,I]=(0,o.useState)("Single"),[W,G]=(0,o.useState)(null),[O,F]=(0,o.useState)(14),[B,H]=(0,o.useState)(null),[J,K]=(0,o.useState)(null),[P,R]=(0,o.useState)(null),[V,Q]=(0,o.useState)(!1),[U,X]=(0,o.useState)(0),[Y,Z]=(0,o.useState)([]),{userId:z,userName:ee}=(0,m.J)(),[et,er]=(0,o.useState)(""),[el,eo]=(0,o.useState)(!1),[ea,en]=(0,o.useState)(!1),[eu,ei]=(0,o.useState)(null),[es,ec]=(0,o.useState)(null),ep=(0,d.useRouter)(),[em,eh]=(0,o.useState)(!1),ey=(0,p.v)(B||z,"\uD83D\uDD25","fire"),ef=(0,p.v)(J,"❄️","ice"),[ed,ew]=(0,o.useState)(null),[ev,ek]=(0,o.useState)(0),[eb,eg]=(0,o.useState)(""),[eS,eA]=(0,o.useState)(""),eM=(e,t)=>e>=0&&e<8&&t>=0&&t<8,eE=e=>Array.isArray(e)?e.map(e=>Array.isArray(e)?e.map(e=>{if(!e)return null;let{validMove:t,...r}=e;return r.type?r:null}):Array(8).fill(null)):k(),eq=(e,t,r)=>{let l=r[e][t];if(!l)return[];let o=[],a="white"===l.color?-1:1;if("pawn"===l.type){for(let n of(eM(e+a,t)&&!r[e+a][t]&&(o.push([e+a,t]),!l.moved&&eM(e+2*a,t)&&!r[e+a][t]&&!r[e+2*a][t]&&o.push([e+2*a,t])),[-1,1])){let u=e+a,i=t+n;eM(u,i)&&r[u][i]?.color&&r[u][i].color!==l.color&&o.push([u,i])}return o}return"knight"===l.type?[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].forEach(a=>{let[n,u]=a,i=e+n,s=t+u;eM(i,s)&&(!r[i][s]||r[i][s].color!==l.color)&&o.push([i,s])}):({bishop:[[-1,-1],[-1,1],[1,-1],[1,1]],rook:[[-1,0],[1,0],[0,-1],[0,1]],queen:[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]],king:[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]]})[l.type].forEach(a=>{let[n,u]=a,i=e+n,s=t+u;for(;eM(i,s);){if(r[i][s]){r[i][s].color!==l.color&&o.push([i,s]);break}if(o.push([i,s]),!["queen","rook","bishop"].includes(l.type))break;i+=n,s+=u}}),o},ex=(r,l)=>{let o=e[r][l];if(!o)return;let a=o.color,n=eq(r,l,e).filter(t=>{let[o,n]=t;return!eL(a,e_(e,{from:[r,l],to:[o,n]}))}),u=eE(e);n.forEach(e=>{let[t,r]=e;u[t][r]={...u[t][r]||{},validMove:!0}}),t(u)},ej=async(r,l,o,a)=>{let u=e.map(e=>e.map(e=>e?.type?{...e}:null)),i={...u[r][l],moved:!0};if("king"===i.type&&2===Math.abs(l-a)){let e=7*(a>l),t=a>l?5:3;u[r][t]={...u[r][e],moved:!0},u[r][e]=null}u[o][a]&&u[o][a].color!==i.color?(0,n.Gj)():(0,n.oS)(),u[o][a]=i,u[r][l]=null,"pawn"===i.type&&(0===o||7===o)&&(u[o][a].type="queen"),t(eE(u)),G(null);let c={from:{row:r,col:l},to:{row:o,col:a}};if(ew(c),setTimeout(()=>ew(null),3e3),"Multiplayer"===D){let e=C===B?J:B;L(e),(0,s.lu)(P.room,{board:u,lastMove:c},O,e)}else T("white"===_?"black":"white"),eW(u)},e$=(l,o)=>{if(r||"Single"===D&&"black"===_)return;if("Multiplayer"===D&&C!==z)return void alert("Not your turn!");let a=e[l][o],n="Multiplayer"===D?z===B?"white":"black":"white";if(W?.row===l&&W?.col===o){G(null),t(eE(e));return}if(!W){a?.color===n&&(G({row:l,col:o}),ex(l,o));return}if(!eL(n,e_(e,{from:[W.row,W.col],to:[l,o]}))){if(a?.validMove)return void ej(W.row,W.col,l,o);if(a?.color===n){G({row:l,col:o}),ex(l,o);return}G(null),t(eE(e))}},eN=e=>{let t={pawn:1,knight:3,bishop:3,rook:5,queen:9,king:100},r=0;return e.forEach(e=>{e.forEach(e=>{if(e){let l=t[e.type];r+="black"===e.color?l:-l}})}),r},e_=(e,t)=>{let r=e.map(e=>e.map(e=>e?{...e}:null)),[l,o]=t.from,[a,n]=t.to,u=r[l][o];if(!u)return r;if("king"===u.type&&2===Math.abs(o-n)){let e=7*(n>o);r[l][n>o?5:3]={...r[l][e],moved:!0},r[l][e]=null}return"pawn"===u.type&&(0===a||7===a)?r[a][n]={...u,type:"queen",moved:!0}:r[a][n]={...u,moved:!0},r[l][o]=null,r},eT=()=>{let t=eI("black",e);if(0===t.length)return;let r=-1/0,l=[];if(t.forEach(t=>{let o=e_(e,t),a=eN(o);eL("black",o)||(a+=50),eW(o)&&(a+=1e3),a>r?(r=a,l=[t]):a===r&&l.push(t)}),l.length>0){let e=l[Math.floor(Math.random()*l.length)];ej(e.from[0],e.from[1],e.to[0],e.to[1])}};(0,o.useEffect)(()=>{if("Single"===D&&!r&&"black"===_){let e=setTimeout(eT,500);return()=>clearTimeout(e)}},[e,_,D,r]);let eC=(e,t)=>{if(!t||!Array.isArray(t))return!1;for(let r=0;r<8;r++){let l=t[r];if(l)for(let t=0;t<8;t++){let o=l[t];if(o?.type==="king"&&o.color===e)return{row:r,col:t}}}return null},eL=(e,t)=>{if(!t||!Array.isArray(t))return!1;let r=eC(e,t);return!!r&&eD(r.row,r.col,e,t)},eD=(e,t,r,l)=>{if(!l||!Array.isArray(l))return!1;let o="white"===r?"black":"white";for(let r=0;r<8;r++)for(let a=0;a<8;a++){let n=l[r][a];if(n?.color===o&&eq(r,a,l).some(r=>{let[l,o]=r;return l===e&&o===t}))return!0}return!1},eI=(e,t)=>{if(!Array.isArray(t)||8!==t.length||!t.every(e=>Array.isArray(e)&&8===e.length))return[];let r=[],l=t.map(e=>[...e]);for(let t=0;t<8;t++)for(let o=0;o<8;o++){let a=l[t][o];a?.color===e&&eq(t,o,l).forEach(a=>{let[n,u]=a;eL(e,e_(l,{from:[t,o],to:[n,u]}))||r.push({from:[t,o],to:[n,u]})})}return r},eW=t=>{if(!Array.isArray(t)||8!==t.length||!t.every(e=>Array.isArray(e)&&8===e.length))return!1;let r="Multiplayer"===D?C===B?"white":"black":_;if(eL(r,t)&&0===eI(r,t).length){let t="white"===r?"black":"white";return(0,s.lu)(P.room,e,O,null,"Multiplayer"===D?"white"===t?B:J:t),!0}if(0===eI(r,t).length){let t="white"===r?"black":"white";return"Multiplayer"===D?(0,s.lu)(P.room,e,O,null,"white"===t?B:J):S(t),!0}return!1};(0,o.useEffect)(()=>{"Multiplayer"===D&&!r&&e&&eW(e)},[e,C,D,r]),(0,o.useEffect)(()=>{(async()=>{g&&(b(!0),"Multiplayer"===D&&(g===z?(eo(!0),await (0,s.Hy)(g,O)):g!==z&&await (0,s.oH)(z,O)),g===z||"Fire"===g?((0,n.Yj)(),(0,i.Lk)()):g!==z&&(0,n.SI)(),"Multiplayer"===D?B===g?q(e=>e+1):J===g&&X(e=>e+1):("White"===g&&q(e=>e+1),"Black"===g&&j(e=>e+1)),(0,n.XQ)(),N(!0),setTimeout(()=>{"Multiplayer"===D?en(!0):eO(),N(!1),er("")},3500))})()},[g,P,D,z,B,J]),(0,o.useEffect)(()=>{if(!P?.room)return;let e=(0,s.PI)(P.room,e=>{let{user_id:t,choice:r}=e;t===z?null==eu&&ei(r):null==es&&ec(r)});return()=>s.ND.realtime.removeChannel(e)},[P,z,ev]),(0,o.useEffect)(()=>{if(null==eu||null==es)return;let e="up"===eu&&"up"===es,t=P.room;(0,s.DL)(t).then(()=>{ei(null),ec(null),en(!1),ek(e=>e+1),e?eO():eF()}).catch(console.error)},[eu,es]);let eG=async r=>{r&&r.room?(R(r),H(r.player1),K(r.player2),eg(r.player1name||""),eA(r.player2name||""),I("Multiplayer"),M(!0),L(r.player1),Q(!!r.player1&&!!r.player2),Z([(0,s.Z5)(r.room,t=>{H(t.player1),K(t.player2),eg(t.player1name||""),eA(t.player2name||""),Q(!!t.player1&&!!t.player2),(0,n.NL)("battle"),t.player1&&t.player2&&e.every(e=>e.every(e=>null===e))&&(0,s.lu)(r.room,e,O,t.player1)}),(0,s.qk)(r.room,e=>{e.board_state&&(t(Array.isArray(e.board_state.board)&&8===e.board_state.board.length&&e.board_state.board.every(e=>Array.isArray(e))?e.board_state.board:k()),ew(e.board_state.lastMove),b(!1),S(null),N(!1),en(!1),er(""),ei(null),ec(null),(0,s.DL)(e.room)),void 0!==e.current_turn&&null!==e.current_turn&&L(e.current_turn),e.winner&&(er(e.name),S(e.winner),(0,h.v)(e.winner,"hard"),(0,s.JI)(e.room,e.game_id))})])):(I("Single"),M(!0))},eO=()=>{let e=k();if(t(e),b(!1),S(null),N(!1),en(!1),G(null),ei(null),ec(null),"Single"===D)T("white");else if("Multiplayer"===D){let t=g===J?J:B;L(t),(0,s.lu)(P.room,e,O,t)}(0,n.SW)()},eF=()=>{eh(!1),"Multiplayer"===D&&((0,s.i4)(P.room,O),(0,s.Kt)(P.room)),ep.push("/")};(0,o.useEffect)(()=>()=>{"Multiplayer"===D&&(0,s.Kt)(Y)},[Y]),(0,o.useEffect)(()=>{let e;if("Multiplayer"!==D)return;let t=()=>{clearTimeout(e),e=window.setTimeout(()=>{eh(!0)},3e4)},r=["mousemove","keydown","mousedown","touchstart"];return r.forEach(e=>window.addEventListener(e,t)),t(),()=>{clearTimeout(e),r.forEach(e=>window.removeEventListener(e,t))}},[J]),(0,o.useEffect)(()=>{if("Multiplayer"!==D)return;window.history.pushState(null,"",window.location.href);let e=e=>{e.preventDefault(),window.history.pushState(null,"",window.location.href),eh(!0)};return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[D]),(0,o.useEffect)(()=>{if("Multiplayer"!==D)return;let e=e=>{eh(!0),e.preventDefault(),e.returnValue=""};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[D]),(0,o.useEffect)(()=>{if(!P?.room||"Multiplayer"!==D)return;let e=Date.now(),t=setInterval(()=>{Date.now()-e>6e4&&(alert("Ops, Opponent left the game! What a bummer!"),eF())},1e4);return()=>clearInterval(t)},[e]);let eB=null===g?"It's a Draw!":g?"Multiplayer"===D?`${et} wins!`:`${g} wins!`:"Opponent Turn";return A?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"mq-global-container",children:[(0,l.jsxs)("div",{className:"mq-score-container",children:[(0,l.jsx)("span",{className:"mq-score-player",children:(0,l.jsxs)("span",{className:"mq-score-player",children:[eb||ee,": ",E]})}),(0,l.jsxs)("span",{className:"mq-room-number",children:[P&&P.room," ",P&&P.password&&`- ${P.password}`]}),(0,l.jsx)("span",{className:"mq-score-computer",children:"Multiplayer"===D?eS?`${eS}: ${U}`:"Waiting opponent...":`Ice: ${x}`})]}),(0,l.jsxs)("div",{className:`mq-board mq-${"Multiplayer"===D?C===B?ey.theme:ef.theme:"white"===_?ey.theme:"black"}`,children:[$&&(0,l.jsx)("h1",{className:`mq-ending-title ${("black"===g||g===J)&&"glowingBlue-text"}`,children:eB}),e.map((t,r)=>(0,l.jsx)("div",{className:"mq-row",children:t.map((t,o)=>(0,l.jsx)("div",{className:`mq-square ${(r+o)%2==1?"mq-dark":"mq-light"}${t?.validMove?" valid":""}${W?.row===r&&W?.col===o?" mq-selected":""} ${ed?.from.row===r&&ed?.from.col===o||ed?.to.row===r&&ed?.to.col===o?" mq-last-move":""}${t?.color==="white"?" white-piece":""}${t?.color==="black"?" black-piece":""}${t?.type==="king"&&eL(t.color,e)?" in-check":""}`,onClick:()=>e$(r,o),children:t?.type&&v[t.color][t.type]},`${r}-${o}`))},r))]})]}),(0,l.jsx)(u.A,{text:"Reset Score",onClick:()=>{j(0),q(0)}}),el&&(0,l.jsx)(y.T,{onComplete:()=>eo(!1)}),(0,l.jsx)(f.A,{isOpen:ea,onClose:()=>{en(!1)},onThumbsUp:()=>{ei("up"),(0,s.r7)(P.room,z,"up")},onThumbsDown:()=>{ei("down"),(0,s.r7)(P.room,z,"down")}}),(0,l.jsx)(w.A,{isOpen:em,onConfirm:eF,onCancel:()=>eh(!1),title:"Leave Game? Auto-quit in "})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a.A,{introText:"Welcome to Chess! Play as White. Take turns moving your pieces according to chess rules. Valid moves will be highlighted. Checkmate your opponent to win! Good luck!"}),(0,l.jsx)(c.A,{gameId:O,setGameMode:I,onStartGame:e=>eG(e)})]})}}}]);